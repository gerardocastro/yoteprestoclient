"use strict";angular.module("yoteprestoclientApp",["ngAnimate","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch","ng-token-auth","LocalStorageModule"]).config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"views/main.html",controller:"UserSessionCtrl",reloadOnSearch:!0,resolve:{auth:["$auth","$window",function(a,b){var c=a.validateUser();c.then(function(a){b.location.href="/#/profile"})}]}}).when("/profile",{templateUrl:"views/profile.html",controller:"ProfileCtrl",resolve:{auth:["$auth","$window",function(a,b){a.validateUser()["catch"](function(a){b.location.href="/#/"})}]}}).when("/applications",{templateUrl:"views/applications.html",controller:"ApplicationsCtrl",resolve:{auth:["$auth","$window",function(a,b){a.validateUser()["catch"](function(a){b.location.href="/#/"})}]}}).otherwise({redirectTo:"/#/"})}]).config(["localStorageServiceProvider",function(a){a.setPrefix("ls")}]).config(["$authProvider",function(a){a.configure({apiUrl:"https://yoteprestoapi.herokuapp.com/api/v1",tokenValidationPath:"/auth/validate_token",signOutUrl:"/auth/sign_out",emailRegistrationPath:"/auth/auth",emailSignInPath:"/auth/sign_in",authProviderPaths:{facebook:"/auth/facebook"}})}]),angular.module("yoteprestoclientApp").controller("UserSessionCtrl",["$scope","$rootScope","$auth","$window",function(a,b,c,d){a.loginError=!1,b.$on("auth:login-error",function(b,c){a.loginError=!0,a.loginErrorMessage=c.errors[0]}),b.$on("auth:login-success",function(a,b){d.location.href="/#/profile"})}]),angular.module("yoteprestoclientApp").controller("ProfileCtrl",["$scope","$rootScope","$window","$auth","$filter","User","formatErrors","profileFinished",function(a,b,c,d,e,f,g,h){function i(a){var b=Object.keys(a).length-3,c=e("emptyAttributes")(a)-1;return 1>c?100:Math.ceil(c/b*100)}function j(b){h.set(b),a.profileFinished=b}a.profileFinished=h.get(),a.sexOptions=["","Male","Female"],a.user=f.get(function(b){a.progress=i(b),j(b.finished)}),a.updateUser=function(){a.user.$update(function(b){a.alertMessage="Your profile was updated.",a.alertType="alert-success",j(b.finished)},function(b){a.alertMessage=g.query(b.data),a.alertType="alert-danger"})},b.$on("auth:logout-success",function(a){c.location.href="/#/"}),b.$on("auth:logout-error",function(a,b){c.location.href="/#/"})}]),angular.module("yoteprestoclientApp").factory("User",["$resource",function(a){return a("https://yoteprestoapi.herokuapp.com/api/v1/users",null,{update:{method:"PUT"}})}]),angular.module("yoteprestoclientApp").directive("alert",function(){return{restrict:"E",template:'<div ng-if="alertMessage" class="alert {{alertType}} text-center" role="alert">{{alertMessage}}</div>'}}),angular.module("yoteprestoclientApp").factory("formatErrors",["$resource",function(a){return{query:function(a){if(Object.keys(a).length>0){var b="";for(var c in a)b+=c+": "+a[c]+"\n";return b}return"All fields must be filled."}}}]),angular.module("yoteprestoclientApp").filter("emptyAttributes",function(){return function(a){var b=0;for(var c in a)a[c]||(b+=1);return b}}),angular.module("yoteprestoclientApp").controller("ApplicationsCtrl",["$scope","$rootScope","$window","$auth","$filter","Application","formatErrors","profileFinished",function(a,b,c,d,e,f,g,h){function i(){f.save({application:a.application},function(b){a.alertMessage="Your application was created.",a.alertType="alert-success",a.applications.push(b)},function(b){a.alertMessage=g.query(b.data),a.alertType="alert-danger"})}function j(b){a.application=f.update({id:a.applicationId,application:a.application},function(c){k(b,angular.copy(c)),a.alertMessage="Your application was upated.",a.alertType="alert-success"},function(b){a.alertMessage=g.query(b.data),a.alertType="alert-danger"})}function k(b,c){var d=a.applications,f=e("filter")(d,{id:b},!0),g=d.indexOf(f[0]);d.splice(g,1),d.push(c)}h.get()||(c.location.href="/#/profile"),a.profileFinished=h.get(),a.canRemoveExpense=!1,a.applications=f.query(),a.expensesTypes=["Credit card","Entertaining","Services","School","Insurance","rent/Mortgage"],a.relationTypes=["Friend","Co-worker","Neighbor"],a.newApplication=function(){a.alertMessage=null,a.action="create",a.applicationId=null,a.application=new f,a.application.references_attributes=[{},{},{}],a.application.expenses_attributes=[{}]},a.editApplication=function(b){a.alertMessage=null,a.action="update",a.applicationId=b,a.application=f.get({id:b},function(b){b.expenses_attributes.length>1&&(a.canRemoveExpense=!0)},function(b){a.alertMessage="There was an error trying to get the application.",a.alertType="alert-danger"})},a.saveApplication=function(){"create"==a.action?i():j()},a.addExpense=function(){a.canRemoveExpense=!0,a.application.expenses_attributes.push({})},a.removeExpense=function(b){console.log(b),a.canRemoveExpense=!1,a.application.expenses_attributes[b]._destroy=!0},b.$on("auth:logout-success",function(a){c.location.href="/#/"}),b.$on("auth:logout-error",function(a,b){c.location.href="/#/"})}]),angular.module("yoteprestoclientApp").service("profileFinished",["localStorageService",function(a){return{set:function(b){a.add("profileFinished",b)},get:function(b){var c=a.get("profileFinished");return 1==c?!0:!1}}}]),angular.module("yoteprestoclientApp").service("Application",["$resource",function(a){return a("https://yoteprestoapi.herokuapp.com/api/v1/applications/:id",{id:"@_id"},{update:{method:"PUT",params:{id:"@id"}}})}]),angular.module("yoteprestoclientApp").run(["$templateCache",function(a){a.put("views/applications.html",'<div ng-include="\'views/bars/logged_in_bar.html\'"></div> <div class="container"> <div class="col-md-2 col-md-offset-10"> <a herf="javascript:void(0)" ng-click="newApplication()" class="btn btn-primary btn-lg btn-block" data-toggle="modal" data-target="#applicationModal"> New </a> </div> <div class="col-md-12"> <table class="table table-hover"> <thead> <tr> <th>Loan title</th> <th>Loan detail</th> <th>Loan destination</th> <th>Funding days</th> <th></th> </tr> </thead> <tbody> <tr ng-repeat="application in applications | orderBy : \'id\'"> <td>{{ application.loan_title }}</td> <td>{{ application.loan_detail }}</td> <td>{{ application.loan_destination }}</td> <td>{{ application.funding_days }}</td> <td> <a herf="javascript:void(0)" ng-click="editApplication(application.id)" data-toggle="modal" data-target="#applicationModal" class="btn btn-warning"> Edit </a> </td> </tr> </tbody> </table> </div> <div ng-include="\'views/applications/modal_form.html\'"></div> </div>'),a.put("views/applications/expenses.html",'<div class="form-group"> <h4 class="modal-title text-center">Expenses</h4> </div> <div ng-repeat="expense in application.expenses_attributes"> <div ng-if="!expense._destroy"> <div class="form-group"> <label for="expense_type" class="col-sm-3 control-label">Type</label> <div class="col-sm-8"> <select name="expensesType" id="expense_type" class="form-control" ng-model="expense.expense_type" required> <option ng-repeat="expensesType in expensesTypes" value="{{expensesType}}"> {{expensesType}} </option> </select> </div> </div> <div class="form-group"> <label for="amount" class="col-sm-3 control-label">Amount</label> <div class="col-sm-8"> <input type="text" ng-model="expense.amount" class="form-control" id="amount" required> </div> </div> <div ng-if="canRemoveExpense" class="form-group text-center"> <a ng-click="removeExpense($index)">Remove Expense</a> </div> </div> </div>'),a.put("views/applications/loan.html",'<div class="form-group"> <h4 class="modal-title text-center">Loan</h4> </div> <div class="form-group"> <label for="loan_title" class="col-sm-3 control-label">Loan title</label> <div class="col-sm-8"> <input type="text" ng-model="application.loan_title" class="form-control" id="loan_title" required> </div> </div> <div class="form-group"> <label for="loan_detail" class="col-sm-3 control-label">Loan detail</label> <div class="col-sm-8"> <input type="text" ng-model="application.loan_detail" class="form-control" id="loan_detail" required> </div> </div> <div class="form-group"> <label for="loan_destination" class="col-sm-3 control-label">Loan destination</label> <div class="col-sm-8"> <input type="text" ng-model="application.loan_destination" class="form-control" id="loan_destination" required> </div> </div> <div class="form-group"> <label for="funding_days" class="col-sm-3 control-label">Funding days</label> <div class="col-sm-8"> <input type="text" ng-model="application.funding_days" class="form-control" id="funding_days" required> </div> </div> <div class="form-group"> <label for="other_income" class="col-sm-3 control-label">Other income</label> <div class="col-sm-8"> <input type="text" ng-model="application.other_income" class="form-control" id="other_income" required> </div> </div> <div class="form-group"> <label for="education" class="col-sm-3 control-label">Education</label> <div class="col-sm-8"> <input type="text" ng-model="application.education" class="form-control" id="education" required> </div> </div> <div class="form-group"> <label for="pay_job" class="col-sm-3 control-label">Pay job</label> <div class="col-sm-8"> <input type="text" ng-model="application.pay_job" class="form-control" id="pay_job" required> </div> </div> <div class="form-group"> <label for="year_job" class="col-sm-3 control-label">Year job</label> <div class="col-sm-8"> <input type="text" ng-model="application.year_job" class="form-control" id="year_job" required> </div> </div> <div class="form-group"> <label for="company_job" class="col-sm-3 control-label">Company job</label> <div class="col-sm-8"> <input type="text" ng-model="application.company_job" class="form-control" id="company_job" required> </div> </div> <div class="form-group"> <div class="col-sm-offset-3 col-sm-8"> <div class="checkbox"> <label> <input type="checkbox" ng-model="application.has_credit_card" name="has_credit_card"> Credit card </label> </div> </div> </div> <div class="form-group"> <div class="col-sm-offset-3 col-sm-8"> <div class="checkbox"> <label> <input type="checkbox" ng-model="application.has_insurance" name="has_insurance"> Insurance </label> </div> </div> </div> <div class="form-group"> <div class="col-sm-offset-3 col-sm-8"> <div class="checkbox"> <label> <input type="checkbox" ng-model="application.has_car" name="has_car"> Car </label> </div> </div> </div>'),a.put("views/applications/modal_form.html",'<div class="modal fade" id="applicationModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"> <div class="modal-dialog" role="document"> <div class="modal-content"> <form class="form-horizontal" ng-submit="saveApplication()"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button> </div> <div class="modal-body"> <alert></alert> <div ng-include="\'views/applications/loan.html\'"></div> <div ng-include="\'views/applications/expenses.html\'"></div> <div ng-include="\'views/applications/references.html\'"></div> </div> <div class="modal-footer"> <button type="button" class="btn btn-default" ng-click="addExpense()">Add Expense</button> <button type="button" class="btn btn-default" data-dismiss="modal">Close</button> <button type="submit" class="btn btn-primary">Save</button> </div> </form> </div> </div> </div>'),a.put("views/applications/references.html",'<div class="form-group"> <h4 class="modal-title text-center">References</h4> </div> <div ng-repeat="reference in application.references_attributes"> <div class="form-group"> <h5 class="modal-title text-center">Reference {{$index + 1}}</h5> </div> <div class="form-group"> <label for="first_name" class="col-sm-3 control-label">First name</label> <div class="col-sm-8"> <input type="text" ng-model="reference.first_name" class="form-control" id="first_name" required> </div> </div> <div class="form-group"> <label for="second_name" class="col-sm-3 control-label">Second name</label> <div class="col-sm-8"> <input type="text" ng-model="reference.second_name" class="form-control" id="second_name" required> </div> </div> <div class="form-group"> <label for="f_last_name" class="col-sm-3 control-label">First last name</label> <div class="col-sm-8"> <input type="text" ng-model="reference.f_last_name" class="form-control" id="f_last_name" required> </div> </div> <div class="form-group"> <label for="s_last_name" class="col-sm-3 control-label">Second last name</label> <div class="col-sm-8"> <input type="text" ng-model="reference.s_last_name" class="form-control" id="s_last_name" required> </div> </div> <div class="form-group"> <label for="mobile" class="col-sm-3 control-label">Mobile</label> <div class="col-sm-8"> <input type="text" ng-model="reference.mobile" class="form-control" id="mobile" required> </div> </div> <div class="form-group"> <label for="relation_type" class="col-sm-3 control-label">Relation type</label> <div class="col-sm-8"> <select name="expensesType" id="relation_type" class="form-control" ng-model="reference.relation_type" required> <option ng-repeat="relationType in relationTypes" value="{{relationType}}"> {{relationType}} </option> </select> </div> </div> </div>'),a.put("views/bars/logged_in_bar.html",'<div class="header"> <div class="navbar navbar-default" role="navigation"> <div class="container"> <div class="navbar-header"> <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#js-navbar-collapse"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="#/"> <img src="https://s3-us-west-2.amazonaws.com/assets-site-v2/img/logo.png"> </a> </div> <div class="collapse navbar-collapse" id="js-navbar-collapse"> <ul class="nav navbar-nav navbar-right"> <li ng-if="profileFinished"> <a href="/#/applications"> <span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span> <b>Applications</b> </a> </li> <li> <a href="/#/profile"> <span class="glyphicon glyphicon-user" aria-hidden="true"></span> <b>Profile</b> </a> </li> <li> <a href="javascript:void(0)" ng-click="signOut()"> <span class="glyphicon glyphicon-log-out" aria-hidden="true"></span> <b>Sign out</b> </a> </li> </ul> </div> </div> </div> </div>'),a.put("views/bars/logged_out_bar.html",'<div class="header"> <div class="navbar navbar-default" role="navigation"> <div class="container"> <div class="navbar-header"> <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#js-navbar-collapse"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="#/"> <img src="https://s3-us-west-2.amazonaws.com/assets-site-v2/img/logo.png"> </a> </div> <div class="collapse navbar-collapse" id="js-navbar-collapse"> <ul class="nav navbar-nav navbar-right"> <li class="dropdown"> <a href="javascript:void(0)" class="dropdown-toggle" data-toggle="dropdown"> <b>Login</b> <span class="caret"> </span> </a> <ul id="login-dp" class="dropdown-menu"> <li> <div class="row"> <div class="col-md-12"> <div class="title text-center"> <h4>Sign in</h4> </div> <div ng-if="loginError"> {{ loginErrorMessage }} </div> <form ng-submit="submitLogin(loginForm)" role="form" ng-init="loginForm = {}"> <div class="form-group"> <label class="sr-only" for="exampleInputEmail2">Username</label> <input type="text" name="username" ng-model="loginForm.username" placeholder="Username" class="form-control" required> </div> <div class="form-group"> <label class="sr-only" for="exampleInputPassword2">Password</label> <input type="password" name="password" ng-model="loginForm.password" placeholder="Password" class="form-control" required> </div> <div class="form-group"> <button type="submit" class="btn btn-primary btn-block">Sign in</button> </div> <div class="help-block text-right"> <a href="">Forgot the password?</a> </div> </form> <div class="bottom text-center"> New here ? <b>Join Us</b> </div> <div class="text-center"> <a ng-click="authenticate(\'facebook\', {params: oAuthForm})" class="btn btn-primary btn-fb btn-block"> Sign up with facebook </a> </div> </div> </div> </li> </ul> </li> </ul> </div> </div> </div> </div>'),a.put("views/main.html",'<div ng-include="\'views/bars/logged_out_bar.html\'"></div> <div class="container"> <img src="http://afico.org/images/logo%20yotepresto.jpg" class="img-responsive center-block"> </div>'),a.put("views/profile.html",'<div ng-include="\'views/bars/logged_in_bar.html\'"></div> <div class="container"> <div class="col-md-11"> <alert></alert> <div class="panel panel-success"> <div class="panel-heading text-center"> <h4>PROFILE</h4> </div> <form class="form-horizontal" ng-submit="updateUser()"> <div class="panel-body"> <div class="col-md-3"> <img ng-src="{{ user.image }}?type=large" style="width: 100%"> <div class="panel panel-default"> <div class="panel-body"> <div class="progress"> <div class="progress-bar progress-bar-success progress-bar-striped" role="progressbar" aria-valuenow="{{progress}}" aria-valuemin="0" aria-valuemax="100" style="width: {{progress}}%"> {{progress}}% </div> </div> </div> <div class="panel-footer text-center"> Profile completed </div> </div> </div> <div class="col-md-8"> <div class="form-group"> <label for="username" class="col-sm-3 control-label">Username</label> <div class="col-sm-9"> <input type="text" ng-model="user.username" class="form-control" id="username"> </div> </div> <div class="form-group"> <label for="email" class="col-sm-3 control-label">Email</label> <div class="col-sm-9"> <input type="email" ng-model="user.email" class="form-control" id="email" disabled> </div> </div> <div class="form-group"> <label for="first_name" class="col-sm-3 control-label">First Name</label> <div class="col-sm-9"> <input type="text" ng-model="user.first_name" class="form-control" id="first_name"> </div> </div> <div class="form-group"> <label for="second_name" class="col-sm-3 control-label">Second Name</label> <div class="col-sm-9"> <input type="text" ng-model="user.second_name" class="form-control" id="second_name"> </div> </div> <div class="form-group"> <label for="f_last_name" class="col-sm-3 control-label">Fist Last Name</label> <div class="col-sm-9"> <input type="text" ng-model="user.f_last_name" class="form-control" id="f_last_name"> </div> </div> <div class="form-group"> <label for="s_last_name" class="col-sm-3 control-label">Second Last Name</label> <div class="col-sm-9"> <input type="text" ng-model="user.s_last_name" class="form-control" id="s_last_name"> </div> </div> <div class="form-group"> <label for="sex" class="col-sm-3 control-label">Sex</label> <div class="col-sm-9"> <select name="sex" id="sex" class="form-control" ng-model="user.sex"> <option ng-repeat="option in sexOptions" value="{{option}}">{{option}}</option> </select> </div> </div> <div class="form-group"> <label for="curp" class="col-sm-3 control-label">Curp</label> <div class="col-sm-9"> <input type="text" ng-model="user.curp" class="form-control" id="curp" maxlength="18"> </div> </div> <div class="form-group"> <label for="rfc" class="col-sm-3 control-label">RFC</label> <div class="col-sm-9"> <input type="text" ng-model="user.rfc" class="form-control" id="rfc" maxlength="13"> </div> </div> <div class="form-group"> <label for="mobile" class="col-sm-3 control-label">Mobile Phone Number</label> <div class="col-sm-9"> <input type="text" ng-model="user.mobile" class="form-control" id="mobile" maxlength="20"> </div> </div> <div class="form-group"> <label for="phone" class="col-sm-3 control-label">Phone Number</label> <div class="col-sm-9"> <input type="text" ng-model="user.phone" class="form-control" id="phone" maxlength="20"> </div> </div> <div class="form-group"> <label for="password" class="col-sm-3 control-label">Password</label> <div class="col-sm-9"> <input type="password" ng-model="user.password" class="form-control" id="password"> </div> </div> </div> </div> <div class="panel-footer text-right"> <button type="submit" class="btn btn-success">Save</button> </div> </form> </div> </div> </div>')}]);